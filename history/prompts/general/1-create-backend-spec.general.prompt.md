---
id: 1
title: create-backend-spec
stage: spec
date_iso: 2026-02-07
surface: agent
model: Qwen
feature: none
branch: 003-todo-backend-spec
user: user
command: /sp.specify
labels:
  - backend
  - specification
  - fastapi
  - todo
links:
  spec: null
  ticket: null
  adr: null
  pr: null
files_yaml:
  - D:\Todo Hackathon\Phase 2\specs\003-todo-backend-spec\spec.md
  - D:\Todo Hackathon\Phase 2\specs\003-todo-backend-spec\checklists\requirements.md
tests_yaml: []
prompt_text: "$ARGUMENTS\n\nCreate or update the feature specification from a natural language feature description.\n\n## User Input\n\n```text\n$ARGUMENTS\n```\n\nYou **MUST** consider the user input before proceeding (if not empty).\n\n## Outline\n\nThe text the user typed after `/sp.specify` in the triggering message **is** the feature description. Assume you always have it available in this conversation even if `/sp.specify Create a comprehensive, detailed specification **exclusively for the backend** of the Todo Full-Stack Web Application (Hackathon Phase 2). This specification must enable complete backend implementation and guaranteed successful integration with the already-planned Next.js frontend. Project Context (from constitution and frontend spec): - Backend stack: FastAPI (Python 3.11+), SQLModel (ORM + Pydantic), Neon Serverless PostgreSQL - Authentication: JWT tokens issued by Better Auth (frontend) → verified in backend using shared secret - Shared secret: BETTER_AUTH_SECRET=70tvEiM4SIXNZegpxN5TQRvMiUGePVwU (must be used in env/config) - Database connection: Use exactly this URL from .env: DATABASE_URL = postgresql://neondb_owner:npg_8USzj6FdhfkE@ep-delicate-credit-airvucw7-pooler.c-4.us-east-1.aws.neon.tech/neondb?sslmode=require&channel_binding=require - Frontend integration: Frontend will call these endpoints from http://localhost:3000 using fetch/axios with header: Authorization: Bearer <jwt-token-from-better-auth-session> - Goal: Secure, multi-user backend that enforces ownership and returns data in a format the frontend expects Must-Have Functional Requirements (Backend Only): 1. JWT Authentication Middleware - Extract token from Authorization: Bearer <token> - Verify signature using BETTER_AUTH_SECRET and HS256 algorithm - Extract user_id from payload[\"sub\"] (string) - Attach user to request.state.user - Reject invalid/expired/missing token → 401 Unauthorized with JSON {\"detail\": \"...\"} 2. Database Models (SQLModel) - Task model: - id: int primary key auto-increment - user_id: str not null (foreign key reference to users.id – string) - title: str not null, max_length=200 - description: str | None, max_length=1000 - completed: bool default=False - created_at: datetime default=datetime.utcnow - updated_at: datetime default=datetime.utcnow, onupdate=datetime.utcnow - Use SQLModel.metadata.create_all() on startup or provide migration note 3. REST API Endpoints (base: /api) - GET /api/tasks → Return list of tasks where user_id == current_user.id → Optional query params: ?status=pending|completed|all (default all) → Response: array of Task objects (JSON) - POST /api/tasks → Body: { \"title\": str (required), \"description\": str (optional) } → Auto-set user_id from JWT → Return created task (201 Created) - GET /api/tasks/{task_id} → Return single task if owned by current_user, else 403/404 - PUT /api/tasks/{task_id} → Body: { \"title\": str, \"description\": str } (partial update allowed) → Update only if owned, else 403 - DELETE /api/tasks/{task_id} → Delete only if owned, else 403 - PATCH /api/tasks/{task_id}/complete → Toggle completed field (true ↔ false) → Return updated task 4. Ownership Enforcement - Every CRUD operation (except create) MUST check task.user_id == current_user.id - Violation → 403 Forbidden {\"detail\": \"You do not own this task\"} 5. Validation & Pydantic Models - TaskCreate: title required, description optional - TaskUpdate: title and description optional (partial) - TaskRead: full model for responses (include id, user_id?, completed, timestamps) 6. Database Connection & Dependencies - Async engine + session using provided Neon DATABASE_URL - Dependency: async def get_db() → AsyncSession - Dependency: async def get_current_user(...) → dict with id 7. CORS & Startup - Add CORS middleware allowing origin http://localhost:3000 - On startup: create tables if not exist (or note Alembic usage) Non-Functional Requirements: - All endpoints protected by JWT dependency - JSON responses only (use response_model=...) - Error responses standardized: {\"detail\": str} - Use async/await where possible (SQLModel async support) - Logging: basic print or logging module for startup/errors - Security: Never return other users' tasks, no sensitive data in responses Success Criteria: - Backend must be fully implementable from this spec - All 5 CRUD operations + toggle work with ownership check - Frontend can call endpoints with Bearer token and receive expected JSON - JWT verification works with given BETTER_AUTH_SECRET - Neon DB connection succeeds with provided URL - Clear ownership isolation: user A cannot see/modify user B's tasks - All validation errors return 422 with field details Constraints & Out of Scope (for this backend spec): - Do NOT include Next.js code, UI, or frontend auth pages - Do NOT implement users table – assume Better Auth manages users, only use user_id string - No extra fields/features (no priority, tags, due_date, search, sort yet) - No file uploads, pagination, rate limiting, or advanced auth flows - No deployment config (docker, nginx) – only local dev Output Format: Generate in clean Markdown: - # Specification: todo-backend-fastapi-neon-phase2 - ## Overview & Integration Goals - ## Authentication & JWT Verification - ## Database Schema & Connection - ## API Endpoints (detailed table + descriptions) - ## Data Models (Pydantic + SQLModel) - ## Security & Ownership Rules - ## Error Handling & Validation - ## Startup & CORS Configuration - ## Assumptions & Env Vars Usage - ## Acceptance Checklist ([ ] checkboxes) Do NOT generate any code, plan, tasks, or frontend references beyond API contract. Use the provided .env values (BETTER_AUTH_SECRET, DATABASE_URL) exactly in descriptions. After this spec, the backend should be ready for /sp.plan and full implementation.` appears literally below. Do not ask the user to repeat it unless they provided an empty command."
response_text: "I have successfully created a comprehensive backend specification for the Todo Full-Stack Web Application. The specification covers all required aspects including JWT authentication, database schema, API endpoints, data models, security rules, and error handling. The branch '003-todo-backend-spec' was created, and the complete specification is available at D:\\Todo Hackathon\\Phase 2\\specs\\003-todo-backend-spec\\spec.md. A quality checklist was also created to validate the specification. The specification is ready for the next phase (/sp.plan)."
outcome_evaluation: "The specification was successfully created with all required sections. It meets the quality standards and is ready for implementation planning."
evaluation_details: "All required elements were included in the specification, including user scenarios, functional requirements, success criteria, and security considerations. The specification follows the template structure and is ready for the planning phase."
---

